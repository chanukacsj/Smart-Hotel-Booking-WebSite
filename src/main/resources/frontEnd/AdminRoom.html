<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Room Dashboard</title>
    <!-- ======= Styles ====== -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/AdminDashboard.css">


    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            /*padding: 20px;*/
            text-align: center;
        }

        table {
            width: 95%;
            border-collapse: collapse;
            margin-top: 20px;
            margin: 30px;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background: #007BFF;
            color: white;
        }

        .add-btn {
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .add-btn:hover {
            background: #218838;
        }

        .form-popup {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .form-popup input {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .form-popup button {
            background: #007BFF;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
        }

        .form-popup button:hover {
            background: #0056b3;
        }
    </style>
</head>

<body>
<!-- =============== Navigation ================ -->
<div class="Container">
    <div class="navigation">
        <ul style="padding-left: 0">
            <li>
                <a href="#">
                        <span class="icon">
                            <ion-icon name="logo-apple"></ion-icon>
                        </span>
                    <span class="title">Smart Hotel Booking</span>
                </a>
            </li>

            <li>
                <a href="AdminDashBoard.html">
                        <span class="icon">
                            <ion-icon name="home-outline"></ion-icon>
                        </span>
                    <span class="title">Dashboard</span>
                </a>
            </li>

            <li>
                <a href="AdminCustomer.html">
                        <span class="icon">
                            <ion-icon name="people-outline"></ion-icon>
                        </span>
                    <span class="title">Customers</span>
                </a>
            </li>

            <li>
                <a href="AdminHotel.html">
                        <span class="icon">
               <ion-icon name="bed-outline"></ion-icon></span>
                    <span class="title">Hotels</span>

                </a>
            </li>

            <li>
                <a href="#">
                        <span class="icon">
                            <ion-icon name="help-outline"></ion-icon>
                        </span>
                    <span class="title">Rooms</span>
                </a>
            </li>

            <li>
                <a href="#">
                        <span class="icon">
                            <ion-icon name="settings-outline"></ion-icon>
                        </span>
                    <span class="title">Settings</span>
                </a>
            </li>

            <li>
                <a href="#">
                        <span class="icon">
                            <ion-icon name="lock-closed-outline"></ion-icon>
                        </span>
                    <span class="title">Password</span>
                </a>
            </li>

            <li>
                <a href="#">
                        <span class="icon">
                            <ion-icon name="log-out-outline"></ion-icon>
                        </span>
                    <span class="title">Sign Out</span>
                </a>
            </li>
        </ul>
    </div>
    <!-- ========================= Main ==================== -->
    <div class="main">
        <div class="topbar">
            <div class="toggle">
                <ion-icon name="menu-outline"></ion-icon>
            </div>

            <div class="user">
                <img src="assets/imgs/customer01.jpg" alt="">
            </div>
        </div>
        <div class="Container">
            <h1 style="padding-top: 40px">Room Management</h1>
            <button type="button" class="add-btn" style="margin-top: 38px;margin-right: 10px;border-radius: 5px"
                    data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo"
            >Add Room
            </button>
            <label>
                <input type="text" style="height: 40px ;border-radius: 10px" placeholder="  Search Rooms..."
                       onkeyup="searchCustomer()" id="search">
                <ion-icon name="search-outline"></ion-icon>
            </label>

            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>roomNumber</th>
                    <th>roomType</th>
                    <th>price</th>
                    <th>available</th>
                    <th>hotelId</th>
                    <th>Image1</th>
                    <th>Image2</th>
                    <th>Image3</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="RoomTable">

                </tbody>
            </table>
        </div>
        <!--        Add New Room-->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Add New Room</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="hotelForm">
                            <div class="mb-3">
                                <input type="text" class="form-control" id="RoomNumber" placeholder="Enter RoomNumber" required>
                            </div>
                            <div class="mb-3">
                                <select class="form-select" id="roomType">
                                    <option selected disabled>Select Room Type</option>
                                    <option value="single">Single</option>
                                    <option value="double">Double</option>
                                    <option value="suite">Suite</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <input type="text" class="form-control" id="Price" placeholder="Enter Price" required>
                            </div>
                            <div class="mb-3">
                                <label for="Availability" class="form-label">Availability</label>
                                <select class="form-select" id="Availability" required>
                                    <option selected disabled>Choose Availability</option>
                                    <option value="Available">Available</option>
                                    <option value="Not Available">Not Available</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="HotelID" class="form-label">Select Hotel</label>
                                <select class="form-select" id="HotelID" required>
                                    <option selected disabled>Choose a Hotel</option>
                                </select>
                            </div>
                            <div>
                                <input type="file" id="imageUpload1" name="imageUpload1" required />
                            </div>
                            <div>
                                <input type="file" id="imageUpload2" name="imageUpload2" required />
                            </div>
                            <div>
                                <input type="file" id="imageUpload3" name="imageUpload3" required />
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="btnSave">Save Room</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>Update Room</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="mb-3">
                                <input type="text" class="form-control" id="UpdateRoomNumber" placeholder="Enter RoomNumber" required>
                            </div>
                            <div class="mb-3">
                                <select class="form-select" id="UpdateRoomType">
                                    <option selected disabled>Select Room Type</option>
                                    <option value="single">Single</option>
                                    <option value="double">Double</option>
                                    <option value="suite">Suite</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <input type="text" class="form-control" id="UpdatePrice" placeholder="Enter Price"
                                       required>
                            </div>
                            <div class="mb-3">
                                <label for="Availability" class="form-label">Availability</label>
                                <select class="form-select" id="UpdateAvailability" required>
                                    <option selected disabled>Choose Availability</option>
                                    <option value="Available">Available</option>
                                    <option value="Not Available">Not Available</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="HotelID" class="form-label">Select Hotel</label>
                                <select class="form-select" id="UpdateHotelID" required>
                                    <option selected disabled>Choose a Hotel</option>
                                </select>
                            </div>
                            <div>
                                <input type="file" id="UpdateImageUpload1" accept="image/*">
                            </div>
                            <div>
                                <input type="file" id="UpdateImageUpload2" accept="image/*">
                            </div>
                            <div>
                                <input type="file" id="UpdateImageUpload3" accept="image/*">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="btnUpdate">Update Room</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<!-- =========== Scripts =========  -->
<script src="./js/AdminDashboard.js"></script>

<!-- ====== ionicons ======= -->
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
<script>
    const exampleModal = document.getElementById('exampleModal')
    if (exampleModal) {
        exampleModal.addEventListener('show.bs.modal', event => {
            const button = event.relatedTarget
            const recipient = button.getAttribute('data-bs-whatever')
            const modalTitle = exampleModal.querySelector('.modal-title')
            const modalBodyInput = exampleModal.querySelector('.modal-body input')

            modalTitle.textContent = `New message to ${recipient}`
            modalBodyInput.value = recipient
        })
    }
    $(document).ready(function () {
        const imageUrl = "assets/images/";

        // ✅ Fetch hotels for dropdown
        $.ajax({
            url: "http://localhost:8080/api/v1/hotel/getAll",
            method: "GET",
            contentType: "application/json",
            success: (res) => {
                let hotelDropdown = $("#HotelID");
                hotelDropdown.empty();
                hotelDropdown.append(`<option selected disabled>Choose a Hotel</option>`);

                res.data.forEach((hotel) => {
                    hotelDropdown.append(`<option value="${hotel.id}">${hotel.name}</option>`);
                });
            },
            error: (error) => {
                console.error("Error fetching hotels:", error);
                alert("Failed to load hotels.");
            }
        });

        // ✅ Fetch all rooms and display in table
        $.ajax({
            url: "http://localhost:8080/api/v1/room/getAll",
            method: "GET",
            contentType: "application/json",
            success: (res) => {
                let table = $('#RoomTable');
                table.empty();

                res.data.forEach((room) => {
                    let image1 = imageUrl + room.image1;
                    let image2 = imageUrl + room.image2;
                    let image3 = imageUrl + room.image3;

                    table.append(`
                <tr>
                    <td>${room.id}</td>
                    <td>${room.roomNumber}</td>
                    <td>${room.roomType}</td>
                    <td>${room.price}</td>
                    <td>${room.available}</td>
                    <td>${room.hotelID}</td>
                    <td><img src="${image1}" width="100" height="100" alt="Room Image"
                    onerror="this.onerror=null; this.src='assets/images/default.jpg';"
                    ></td>
                    <td><img src="${image2}" width="100" height="100" alt="Room Image"
                    onerror="this.onerror=null; this.src='assets/images/default.jpg';"
                    ></td>
                    <td><img src="${image3}" width="100" height="100" alt="Room Image"
                    onerror="this.onerror=null; this.src='assets/images/default.jpg';"
                    ></td>
                    <td class="text-center">
                        <button type="button" class="btn btn-danger"
                        data-bs-toggle="modal" data-bs-target="#updateModal"
                        onclick="editRoom('${room.id}', '${room.roomNumber}', '${room.roomType}', '${room.price}', '${room.availability}', '${room.hotelID}', '${room.image1}', '${room.image2}', '${room.image3}')">
                            Edit
                        </button>
                        <button type="button" class="btn btn-warning" onclick="deleteRoom('${room.id}')">Delete</button>
                    </td>
                </tr>
            `);
                });
            },
            error: (error) => {
                console.error("Error fetching rooms:", error);
                alert("Something went wrong while fetching rooms.");
            }
        });
    });

        // ✅ Save new room
        $(document).ready(function () {
            $(document).ready(function() {
                $('#btnSave').click(function () {
                    // Declare the file name variables before use
                    let fileName1 = null;
                    let fileName2 = null;
                    let fileName3 = null;

                    // Get the file input elements
                    let imageInput1 = $("#imageUpload1")[0];
                    if (imageInput1 && imageInput1.files.length > 0) {
                        fileName1 = imageInput1.files[0].name;
                    }

                    let imageInput2 = $("#imageUpload2")[0];
                    if (imageInput2 && imageInput2.files.length > 0) {
                        fileName2 = imageInput2.files[0].name;
                    }

                    let imageInput3 = $("#imageUpload3")[0];
                    if (imageInput3 && imageInput3.files.length > 0) {
                        fileName3 = imageInput3.files[0].name;
                    }

                    // Log the file names to check if they are properly set
                    console.log(fileName1, fileName2, fileName3);

                    $.ajax({
                        url: "http://localhost:8080/api/v1/room/save",
                        method: "POST",
                        contentType: "application/json",
                        data: JSON.stringify({
                            roomNumber: $("#RoomNumber").val(),
                            roomType: $("#roomType").val(),
                            price: $("#Price").val(),
                            available: $("#Availability").val(),
                            hotelID: $("#HotelID").val(),
                            image1: fileName1,
                            image2: fileName2,
                            image3: fileName3
                        }),
                        success: (res) => {
                            alert(res.message || "Room saved successfully.");
                            $('#exampleModal').modal('hide');
                            location.reload();
                        },
                        error: (error) => {
                            console.error("Error saving room:", error);
                            alert("Failed to save room.");
                        }
                    });
                });
            });

        });

    // ✅ Edit room function
    const editRoom = (id, roomNumber, roomType, price, availability, hotelID, image1, image2, image3) => {
        $("#UpdateRoomNumber").val(roomNumber);
        $("#UpdateRoomType").val(roomType);
        $("#UpdatePrice").val(price);
        $("#UpdateAvailability").val(availability);
        $("#UpdateHotelID").val(hotelID);

        $("#UpdateImagePreview1").attr("src", imageUrl + (image1 || "default.jpg"));
        $("#UpdateImagePreview2").attr("src", imageUrl + (image2 || "default.jpg"));
        $("#UpdateImagePreview3").attr("src", imageUrl + (image3 || "default.jpg"));

        $("#UpdateImageUpload1, #UpdateImageUpload2, #UpdateImageUpload3").val("");

        $("#btnUpdate").off("click").on("click", function () {
            let updatedData = {
                roomNumber: $("#UpdateRoomNumber").val(),
                roomType: $("#UpdateRoomType").val(),
                price: $("#UpdatePrice").val(),
                availability: $("#UpdateAvailability").val(),
                hotelID: $("#UpdateHotelID").val(),
                image1: image1,
                image2: image2,
                image3: image3
            };

            let fileInput1 = $("#UpdateImageUpload1")[0].files[0];
            let fileInput2 = $("#UpdateImageUpload2")[0].files[0];
            let fileInput3 = $("#UpdateImageUpload3")[0].files[0];

            if (fileInput1) updatedData.image1 = fileInput1.name;
            if (fileInput2) updatedData.image2 = fileInput2.name;
            if (fileInput3) updatedData.image3 = fileInput3.name;

            updateRoom(id, updatedData);
        });
    };

    // ✅ Update room AJAX request
    const updateRoom = (roomId, updatedData) => {
        $.ajax({
            url: `http://localhost:8080/api/v1/room/update/${roomId}`,
            method: "PUT",
            contentType: "application/json",
            data: JSON.stringify(updatedData),
            success: (res) => {
                alert(res.message || "Room updated successfully.");
                $("#updateModal").modal("hide");
                location.reload();
            },
            error: (error) => {
                console.error("Error updating room:", error);
                alert("Something went wrong while updating.");
            }
        });
    };

    // ✅ Delete room AJAX request
    const deleteRoom = (id) => {
        if (confirm("Are you sure you want to delete this room?")) {
            $.ajax({
                url: `http://localhost:8080/api/v1/room/delete/${id}`,
                method: "DELETE",
                success: (res) => {
                    alert(res.message || "Room deleted successfully.");
                    location.reload();
                },
                error: (error) => {
                    console.error("Error deleting room:", error);
                    alert("Something went wrong while deleting.");
                }
            });
        }
    };


</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossOrigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>

</body>
</html>